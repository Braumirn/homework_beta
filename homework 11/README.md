# Настройка и проверка расширенных списков контроля доступа.
## Топология

![alt text](image.png)

## Таблица адресации
Устройство | interface | IP-адрес | Маска подсети | Шлюз по умолчанию
--- | --- | --- | --- | ---
R1 | G0/0/1 | _ | _ | _
_ | G0/0/1.20 | 10.20.0.1 | 255.255.255.0 | _
_ | G0/0/1.30 | 10.30.0.1 | 255.255.255.0 | _
_ | G0/0/1.40 | 10.40.0.1 | 255.255.255.0 | _
_ | G0/0/1.1000 | _ | _ | _
_ | Loopback1 | 172.16.1.1 | 255.255.255.0 | _
R2 | G0/0/1 | 10.20.0.4 | 255.255.255.0 | _
S1 | VLAN 20 | 10.20.0.2 | 255.255.255.0 | 10.20.0.1
S2 | VLAN 20 | 10.20.0.3 | 255.255.255.0 | 10.20.0.1
PC-A | NIC | 10.30.0.10 | 255.255.255.0 | 10.30.0.1
PC-B | NIC | 10.40.0.10 | 255.255.255.0 | 10.40.0.1
## Таблица VLAN
VLAN | Имя | Назначенный интерфейс
--- | --- | ---
20 | Managment | S2: f0/5
30 | Operations | S1: f0/6 
40 | Sales | S2: F0/18
999 | ParkingLot |*S1: F0/2-4, F0/7-24, G0/1-2*;  **S2: F0/2-4, F0/6-17, F0/19-24, G0/1-2**
1000 | Native | _
## Задачи
1. **Создание сети и настройка основных параметров устройства**
2. **Настройка и проверка списков расширенного контроля доступа**
## Решение
### 1. Создание сети и настройка основных параметров устройства
Подключим устройства, как показано в топологии, и подсоединим необходимые кабели, после чего:
 * Назначим имена устройств.
 * Отключим поиск DNS, чтобы предотвратить попытки устройств неверно преобразовывать введенные команды таким образом, как будто они являются именами узлов.
 * Назначим class в качестве зашифрованного пароля привилегированного режима EXEC.
 * Назначим cisco в качестве пароля консоли и включите вход в систему по паролю.
 * Назначим cisco в качестве пароля VTY и включите вход в систему по паролю.
 * Зашифруем открытые пароли.
 * Создадим баннер с предупреждением о запрете несанкционированного доступа к устройству.
 * Сохраним текущую конфигурацию в файл загрузочной конфигурации.
### 2. Настройка и проверка списков расширенного контроля доступа
#### Часть 1. Настройка сетей VLAN на коммутаторах.
##### Шаг 1. Создайте сети VLAN на коммутаторах.
 * Создадим необходимые VLAN и назовём их на каждом коммутаторе из приведенной выше таблицы.
 * Настроим интерфейс управления и шлюз по умолчанию на каждом коммутаторе, используя информацию об IP-адресе в таблице адресации. 
 * Назначим все неиспользуемые порты коммутатора VLAN Parking Lot, настроим их для статического режима доступа и административно деактивируем их.
##### Шаг 2. Назначьте сети VLAN соответствующим интерфейсам коммутатора.
 * Назначим используемые порты соответствующей VLAN (указанной в таблице VLAN выше) и настроим их для режима статического доступа.
 * Выполним команду `show vlan brief`, чтобы убедиться, что сети VLAN назначены правильным интерфейсам

![alt text](image-1.png)

![alt text](image-5.png)

#### Часть 2. Настройте транки (магистральные каналы).
##### Шаг 1. Вручную настройте магистральный интерфейс F0/1.
 * Изменим режим порта коммутатора на интерфейсе **F0/1**, чтобы принудительно создать магистральную связь.
 * В рамках конфигурации транка установим для **native vlan** значение **1000** на обоих коммутаторах.
 * В качестве другой части конфигурации транка укажем, что **VLAN 10, 20, 30 и 1000** разрешены в транке.
 * Выполним команду `show interfaces trunk` для проверки портов магистрали, собственной VLAN и разрешенных VLAN через магистраль

![alt text](image-3.png) 

Такой же результат на **S2**
##### Шаг 2. Вручную настройте магистральный интерфейс F0/5 на коммутаторе S1.
 * Настроим интерфейс **S1 F0/5** с теми же параметрами транка, что и **F0/1**. Это транк до маршрутизатора.
 * Сохраним текущую конфигурацию в файл загрузочной конфигурации.
 * Используем команду `show interfaces trunk` для проверки настроек транка.
#### Часть 3. Настройте маршрутизацию.
##### Шаг 1. Настройка маршрутизации между сетями VLAN на R1.
 * Активируйте интерфейс **G0/0/1** на маршрутизаторе.
 * Настройте подинтерфейсы для каждой VLAN, как указано в таблице IP-адресации. Все подинтерфейсы используют инкапсуляцию 802.1Q. Убедитесь, что подинтерфейс для собственной VLAN не имеет назначенного IP-адреса. Включите описание для каждого подинтерфейса. Пример:

`R1(config)#interface g0/0/1.20`

`R1(config-subif)#description Management Network`

`R1(config-subif)#encapsulation dot1q 20`

`R1(config-subif)#ip address 10.20.0.1 255.255.255.0`

 * Настройте интерфейс **Loopback 1** на **R1** с адресацией из приведенной выше таблицы.
 * С помощью команды `show ip interface brief` проверьте конфигурацию подынтерфейса.

![alt text](image-4.png)

##### Шаг 2. Настройка интерфейса R2 g0/0/1 с использованием адреса из таблицы и маршрута по умолчанию с адресом следующего перехода 10.20.0.1
`R2(config)# ip route 0.0.0.0 0.0.0.0 10.20.0.1`

`R2(config)# interface g0/0/1`

`R2(config-if)# ip address 10.20.0.4 255.255.255.0`

`R2(config-if)# no shutdown`
#### Часть 4. Настройте удаленный доступ
##### Шаг 1. Настройте все сетевые устройства для базовой поддержки SSH.
 * Создайте локального пользователя с именем пользователя SSHadmin и зашифрованным паролем $cisco123! - `username SSHadmin secret $cisco123!`
 * Используйте ccna-lab.com в качестве доменного имени - `ip domain name ccna-lab.com`
 * Генерируйте криптоключи с помощью 1024 битного модуля - `crypto key generate rsa general-keys modulus 1024`
 * Настройте первые пять линий VTY на каждом устройстве, чтобы поддерживать только SSH-соединения и с локальной аутентификацией:

`line vty 0 4`

`transport input ssh`

`login local`
##### Шаг 2. Включите защищенные веб-службы с проверкой подлинности на R1.
 * Включите сервер HTTPS на R1.
`R1(config)# ip http secure-server` 
 * Настройте R1 для проверки подлинности пользователей, пытающихся подключиться к веб-серверу.
`R1(config)# ip http authentication local`
#### Часть 5. Настройка и проверка списков контроля доступа (ACL)
При проверке базового подключения компания требует реализации следующих политик безопасности:
1. Сеть Sales не может использовать SSH в сети Management (но в  другие сети SSH разрешен). 
2. Сеть Sales не имеет доступа к IP-адресам в сети Management с помощью любого веб-протокола (HTTP/HTTPS). Сеть Sales также не имеет доступа к интерфейсам R1 с помощью любого веб-протокола. Разрешён весь другой веб-трафик (обратите внимание — Сеть Sales  может получить доступ к интерфейсу Loopback 1 на R1).
3. Сеть Sales не может отправлять эхо-запросы ICMP в сети Operations или Management. Разрешены эхо-запросы ICMP к другим адресатам. 
4. Cеть Operations  не может отправлять ICMP эхозапросы в сеть Sales. Разрешены эхо-запросы ICMP к другим адресатам. 
##### Шаг 1. Проанализируйте требования к сети и политике безопасности для планирования реализации ACL.
Политики 1-3 относятся к сети *Sales*, политика №4 к сети *Operations*, следовательно нам понадобятся два расширенных ACL. Расшиернные ACL необходимо ставить как можно ближе к сети-источнику, поэтому список отвечающий за политики №1, 2, 3 надо поставить на вход интерфейса **g0/0/1.40** роутера **R1**, список определяющий 4-ую политику на вход интерфейса **g0/0/1.30** роутера **R1**.
 
##### Шаг 2. Разработка и применение расширенных списков доступа, которые будут соответствовать требованиям политики безопасности.
 * Первый ACL

`R1(config)#ip access-list extended POLICIES_1_2_3`

`R1(config-ext-nacl)#10 deny tcp 10.40.0.0 0.0.0.255 10.20.0.0 0.0.0.255 eq 22`

`R1(config-ext-nacl)#20 deny tcp 10.40.0.0 0.0.0.255 10.20.0.0 0.0.0.255 eq 80`

`R1(config-ext-nacl)#30 deny tcp 10.40.0.0 0.0.0.255 10.30.0.1 0.0.0.0 eq 80`

`R1(config-ext-nacl)#40 deny tcp 10.40.0.0 0.0.0.255 10.40.0.1 0.0.0.0 eq 80`

`R1(config-ext-nacl)#50 deny tcp 10.40.0.0 0.0.0.255 10.20.0.0 0.0.0.255 eq 443`

`R1(config-ext-nacl)#60 deny tcp 10.40.0.0 0.0.0.255 10.30.0.1 0.0.0.0 eq 443`

`R1(config-ext-nacl)#70 deny tcp 10.40.0.0 0.0.0.255 10.40.0.1 0.0.0.0 eq 443`

`R1(config-ext-nacl)#80 deny icmp 10.40.0.0 0.0.0.255 10.20.0.0 0.0.0.255 echo`

`R1(config-ext-nacl)#90 deny icmp 10.40.0.0 0.0.0.255 10.30.0.0 0.0.0.255 echo`

`R1(config-ext-nacl)#100 permit ip any any`

`R1(config-ext-nacl)#int g0/0/1.40`

`R1(config-subif)#ip access-group POLICIES_1_2_3 in`

* Второй ACL

`R1(config)#ip access-list extended POLICY_4`

`R1(config-ext-nacl)#10 deny icmp 10.30.0.0 0.0.0.255 10.40.0.0 0.0.0.255 echo`

`R1(config-ext-nacl)#20 permit ip any any`

`R1(config-ext-nacl)#int g0/0/1.30`

`R1(config-subif)#ip access-group POLICY_4 in`

##### Шаг 3. Убедитесь, что политики безопасности применяются развернутыми списками доступа.
Источник | Протокол | Назначение | Результат
--- | --- | --- | ---
PC-A | Ping | 10.40.0.10 | Сбой
PC-A | Ping | 10.20.0.1 | Успех
PC-B | Ping | 10.30.0.10 | Сбой
PC-B | Ping | 10.20.0.1 | Сбой
PC-B | Ping | 172.16.1.1 | Успех
PC-B | HTTPS | 10.20.0.1 |
PC-B | HTTPS | 172.16.1.1 |
PC-B | SSH | 10.20.0.4 | Сбой
PC-B | SSH | 172.16.1.1 | Успех