# Настройка NAT для IPv4
## Топология

![alt text](image.png)

##  Таблица адресации
Устройство | Интерфейс | IP-адрес | Маска подсети
--- | --- | --- | ---
R1 | G0/0/0 | 209.165.200.230 | 255.255.255.248
_ | G0/0/1 | 192.168.1.1 | 255.255.255.0
R2 | G0/0/0 | 209.165.200.225 | 255.255.255.248
_ | Loopback1 | 209.165.200.1 | 255.255.255.224
S1 | VLAN 1 | 192.168.1.11 | 255.255.255.0
S2 | VLAN 1 | 192.168.1.12 | 255.255.255.0
PC-A | NIC | 192.168.1.2 | 255.255.255.0
PC-B | NIC | 192.168.1.3 | 255.255.255.0
## Цели 
1. **Создание сети и настройка основных параметров устройства**
2. **Настройка и проверка NAT для IPv4**
3. **Настройка и проверка PAT для IPv4**
4. **Настройка и проверка статического NAT для IPv4**
## Решение
### 1. Создание сети и настройка основных параметров устройства
#### Шаг 1. Подключите кабели сети согласно приведенной топологии
Подключим устройства в соответствии с топологией и подсоединим соответствующие кабели.
#### Шаг 2. Произведите базовую настройку маршрутизаторов.
 * Назначим маршрутизатору имя устройства.
 * Отключим поиск DNS, чтобы предотвратить попытки маршрутизатора неверно преобразовывать введенные команды таким образом, как будто они являются именами узлов.
 * Назначим class в качестве зашифрованного пароля привилегированного режима EXEC.
 * Назначим cisco в качестве пароля консоли и включим вход в систему по паролю.
 * Назначим cisco в качестве пароля VTY и включим вход в систему по паролю.
 * Зашифруем открытые пароли.
 * Создадим баннер с предупреждением о запрете несанкционированного доступа к устройству.
 * Настроим IP-адресации интерфейса, как указано в таблице выше.
 * Настроим маршрут по умолчанию. от R2 до  R1.
 * Сохраним текущую конфигурацию в файл загрузочной конфигурации.
#### Шаг 3. Настройте базовые параметры каждого коммутатора
 * Присвоим коммутатору имя устройства.
 * Отключим поиск DNS, чтобы предотвратить попытки маршрутизатора неверно преобразовывать введенные команды таким образом, как будто они являются именами узлов.
 * Назначим class в качестве зашифрованного пароля привилегированного режима EXEC.
 * Назначим cisco в качестве пароля консоли и включим вход в систему по паролю.
 * Назначим cisco в качестве пароля VTY и включим вход в систему по паролю.
 * Зашифруем открытые пароли.
 * Создадим баннер с предупреждением о запрете несанкционированного доступа к устройству.
 * Выключим все интерфейсы, которые не будут использоваться.
 * Настроим IP-адресации интерфейса, как указано в таблице выше.
 * Сохраним текущую конфигурацию в файл загрузочной конфигурации.
### 2. Настройка и проверка NAT для IPv4
#### Шаг 1. Настройте NAT на R1, используя пул из трех адресов 209.165.200.226-209.165.200.228. 
 * Настроим простой список доступа, который определяет, какие хосты будут разрешены для трансляции. В этом случае все устройства в локальной сети **R1** имеют право на трансляцию.

`R1(config)# access-list 1 permit 192.168.1.0 0.0.0.255` 

 * Создадим пул **NAT** и укажем ему имя и диапазон используемых адресов.

`R1(config)#ip nat pool PUBLIC_ACCESS 209.165.200.226 209.165.200.228 netmask 255.255.255.248` 
 
 * Настроим перевод, связывая ACL и пул с процессом преобразования.

`R1(config)# ip nat inside source list 1 pool PUBLIC_ACCESS `

*Примечание: Три очень важных момента. Во-первых, слово «inside» имеет решающее значение для работы такого рода NAT. Если вы опустить его, NAT не будет работать. Во-вторых, номер списка — это номер ACL, настроенный на предыдущем шаге. В-третьих, имя пула чувствительно к регистру.* 
 * Зададим внутренний (inside) интерфейс. 

`R1(config)# interface g0/0/1`

`R1(config-if)# ip nat inside`

 * Определим внешний (outside) интерфейс.

`R1(config)# interface g0/0/0`

`R1(config-if)# ip nat outside`

#### Шаг 2. Проверьте и проверьте конфигурацию. 
 * С **PC-B**,  запустим эхо-запрос интерфейса **Lo1** (209.165.200.1) на **R2**. На R1 отобразим таблицу **NAT** на **R1** с помощью команды `show ip nat translations`.

![alt text](image-3.png)

Вопросы:
1. Во что был транслирован внутренний локальный адрес PC-B? - **209.165.200.226**
2. Какой тип адреса NAT является переведенным адресом? - **Inside Global**
 
 * С **PC-A**, запустим  эхо-запрос интерфейса **Lo1** (209.165.200.1) на **R2**. На **R1** отобразим таблицу **NAT** с помощью команды `show ip nat translations`.

![alt text](image-4.png)

 * Обратим внимание, что предыдущая трансляция для **PC-B** все еще находится в таблице. Из **S1**, эхо-запрос интерфейса **Lo1** (209.165.200.1) на **R2**. На **R1** отобразим таблицу **NAT** на **R1** с помощью команды `show ip nat translations`.

![alt text](image-5.png)

 * Теперь запускаем пинг **R2 Lo1** из **S2**. На этот раз перевод завершается неудачей, и мы получаем эти сообщения (или аналогичные) на консоли **R1**:
Sep 23 15:43:55.562: %IOSXE-6-PLATFORM: R0/0: cpp_cp: QFP:0.0 Thread:000 TS:00000001473688385900 %NAT-6-ADDR_ALLOC_FAILURE: Address allocation failed; pool 1 may be exhausted [2]
 * Это ожидаемый результат, потому что выделено только 3 адреса, и мы попытались *ping Lo1* с четырех устройств. Напомним, что **NAT** — это трансляция «один-в-один». Как много выделено трансляций? Введите команду `show ip nat translations verbose` , и вы увидите, что ответ будет 24 часа.

f.	Учитывая, что пул ограничен тремя адресами, **NAT** для пула адресов недостаточно для нашего приложения. Очистите преобразование **NAT** и статистику, и мы перейдем к **PAT**.

`R1# clear ip nat translations` 

`R1# clear ip nat statistics` 

### 3. Настройка и проверка PAT для IPv4
